1. 代码

   准备好自己要部署的代码。没有的话直接创建一个模板项目

   ```bash
   npm create vite@latest my-vue-app --template vue
   ```

2. oss

   首先开通一个oss云服务。

   服务开通好后，创建一个Bucket。名称随意，地域建议海外，读写权限选择公共读。

   创建好后，就可以手动上传打包后的代码到oss了。上传成功后，就可以通过oss的地址访问我们的代码文件了。

   访问html文件的时候，浏览器会下载index，使用自定义域名可解决。

3. 域名

   注册一个域名。

   进行实名认证，审核大概半天左右。实名认证期间，解析记录不生效，域名不会被解析。

   实名认证后可在oss中绑定自定义域名。位置：Bucket配置->域名管理->绑定域名。选择自动添加CNAME记录，如已有重复的CNAME记录，此开关不可打开。可自行在域名解析管理页面中修改后操作，或者尝试使用二级域名。

   自定义域名配置好后，通过自定义域名访问oss上的html文件，可正常打开。

4. 配置自动发布脚本

   github/gitlab均可。

   思路是代码更新后，依次执行以下命令：安装依赖、打包代码、上传打包后文件到oss。

   其中，安装依赖 和 打包代码的命令 脚手架已经内置了，我们只需要编写上传文件逻辑和编写执行命令的yml文件即可。

   上传文件逻辑，ali oss提供了SDK，以Node JS 为例，代码如下：

   ```javascript
   const OSS = require("ali-oss");
   const fs = require("fs");
   const readDir = (path) => {
     let arr = [];
     let temp = fs.readdirSync(path);
     temp.forEach((v) => {
       if (fs.statSync(path + "/" + v).isDirectory()) {
         arr.push(...readDir(path + "/" + v));
       } else {
         arr.push(path + "/" + v);
       }
     });
     return arr;
   };
   
   let client = new OSS({
     region: "oss-cn-hongkong",
     accessKeyId: process.env.ACCESSKEYID,
     accessKeySecret: process.env.ACCESSKEYSECRET,
   });
   
   client.useBucket("jyb-site");
   readDir("./dist").forEach((file) => {
     client.put(file.split("./dist/")[1], file).then(() => {
       console.log("上传成功:", file);
     });
   });
   
   ```

   SDK初始化时需要需要地域、accessKeyId、accessKeySecret、BucketName信息。

   其中地域为oss外网访问地址的二级域名部分，即`.aliyuncs.com`前面的`oss-cn-xx`。浏览器url上也能找到。

   accessKeyId和accessKeySecret相当于账号和密码。不能储存在代码中，一般上从环境变量中读取。

   gitlab的变量配置在项目设置->CI/CD->变量中添加。

   github的变量配置在Settings->Secrets->Actions中添加。

   yml中变量的访问方式:gitlab`${ VARNAME }` /GitHub`${{ secrets.VARNAME }}`

   变量命名使用大写英文字母加下划线

   SDK不支持直接上传整个目录。所以，需要读取目录下所有文件后，一一上传。

   oss.put 方法有两个参数，第一个是上传后的路径`dirName/fileName.html`，第二个是要上传文件的路径。